<!DOCTYPE html>
<html>
<head>
    <th:block th:replace="/layout/head"></th:block>
</head>

<body>
<div style="padding:4px;width:80px">
    <div class="easyui-panel" style="padding:4px">
        <a href="#" class="easyui-menubutton" data-options="menu:'#mm1',iconCls:'icon-more'">菜单</a>
    </div>
    <div id="mm1" style="width:150px;">
        <th:block sec:authorize="hasAnyAuthority('PROJ_MNG_USER,ADMIN_USER')">
            <div th:href="@{/mng/db_mng}">数据库管理</div>
            <div class="menu-sep"></div>
            <div data-options="iconCls:'icon-man'" th:href="@{/mng/user_mng}">用户管理</div>
            <div class="menu-sep"></div>
        </th:block>
        <div data-options="href:'logout'">退出</div>
    </div>
</div>
<section style="position: absolute; left: 50%; top: 25%;width:500px;height:300px;margin-left:-250px;">
    <h2>当前数据库表设计一览</h2>
    <th:block th:if="${#lists.isEmpty(dbList)}">
        <div style="margin:20px"></div>
        <p>还没有设置访问权限，去找管理员吧．</p>
    </th:block>
    <th:block th:if="${not #lists.isEmpty(dbList)}">
        <p style="font-size: small">点击一览中的项目后，跳转到编辑画面</p>
        <div style="margin:20px 0"></div>
        <ul id="dbList" class="easyui-datalist" lines="true" style="width:100%;height:250px">
            <li th:each="dbItem : ${dbList}" th:value="${dbItem.id}" th:text="${dbItem.dbNameTxt}"></li>
        </ul>
        <div style="margin-top: 5px">
            <input type="checkbox" id="defaultFlg"><label style="font-size: small">将所选择的数据库设置为默认工作环境，下次再登录时不会出现该一览画面．</label>
        </div>
    </th:block>
</section>
<form id="itemForm" method="get" th:action="@{/table_list}">
    <input type="hidden" id="dbId" name="ddId" />
    <input type="hidden" id="checkFlg" name="checkFlg" />
</form>
<script>
    $('#dbList').datalist({
        onClickRow: function (index, row) {
            $('#dbId').val(row.value);
            var isChecked = $('#defaultFlg').prop('checked');
            if (isChecked) {
                $('#checkFlg').val(1);
            } else {
                $('#checkFlg').val(0);
            }
            $('#itemForm').submit();
        }
    });
</script>
</body>
</html>